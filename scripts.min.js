const t=document.getElementById("localVideo"),n=document.getElementById("remoteVideo");document.getElementById("privateMessages"),document.getElementById("globalMessages");const a=document.getElementById("userName"),o=document.getElementById("userFlag"),l=document.getElementById("userAvatar");document.getElementById("openSettings").addEventListener("click",()=>{I()}),document.getElementById("startBtn").addEventListener("click",()=>{E()}),document.getElementById("stopBtn").addEventListener("click",()=>{v()}),document.getElementById("skipBtn").addEventListener("click",()=>{v(),E()}),document.getElementById("muteBtn").addEventListener("click",()=>{e=!e,c&&(c.getAudioTracks()[0].enabled=!e),document.getElementById("muteBtn").innerHTML=e?'<i class="fa-solid fa-volume-xmark"></i>':'<i class="fa-solid fa-volume-high"></i>',i&&m.emit("mute",{muted:e})}),document.getElementById("cameraBtn").addEventListener("click",()=>{d=!d,c&&(c.getVideoTracks()[0].enabled=!d),document.getElementById("cameraBtn").textContent=d?"Turn On Camera":"Turn Off Camera"}),document.getElementById("sendGlobalMessage").addEventListener("click",()=>{var e;(e=document.getElementById("globalMessageInput").value).trim()&&(document.getElementById("globalMessageInput").value="",m.emit("globalMessage",{username:localStorage.getItem("username"),country:localStorage.getItem("country"),profilePic:localStorage.getItem("profilePic"),message:e,time:(new Date).toUTCString(),gif:!1}))}),document.getElementById("sendPrivateMessage").addEventListener("click",()=>{var e;(e=document.getElementById("privateMessageInput").value).trim()&&(document.getElementById("privateMessageInput").value="",i)&&m.emit("privateMessage",{username:localStorage.getItem("username"),country:localStorage.getItem("country"),profilePic:localStorage.getItem("profilePic"),message:e,time:(new Date).toUTCString(),gif:!1})}),document.getElementById("toggleDarkMode").addEventListener("click",()=>{p()}),document.getElementById("saveSettings").addEventListener("click",()=>{var e,t,n;e=document.getElementById("username").value,t=document.getElementById("country").value,n=document.getElementById("profilePic").value,e&&n&&t?(localStorage.setItem("username",e),localStorage.setItem("country",t),localStorage.setItem("profilePic",n),a.textContent=e,o.src=`https://flagcdn.com/w40/${t.toLowerCase()}.png`,l.src=n,$("#settingsModal").modal("hide")):alert("Please enter a username, country and either an avatar URL or select a default avatar.")});let c,s,r,m,e=!1,d=!1,i=!1;const g={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},u=Object.keys(countriesArray),y=Object.values(countriesArray);function p(){document.body.classList.toggle("dark-mode"),document.querySelectorAll("*").forEach(e=>{e.classList.toggle("dark-mode"),e.classList.contains("theme-atom-one-dark")?e.className="theme-atom-one-light":e.classList.contains("theme-atom-one-light")&&(e.className="theme-atom-one-dark")}),localStorage.setItem("darkMode",document.querySelector("html").classList.contains("dark-mode")),"true"==localStorage.getItem("darkMode")?document.getElementById("style").href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/atom-one-dark.min.css":document.getElementById("style").href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/atom-one-light.min.css"}function I(){var t=document.getElementById("country");t.innerHTML="";for(let e=0;e<u.length;e++){var n=document.createElement("option");n.value=y[e],n.innerText=u[e],t.appendChild(n)}t.value=localStorage.getItem("country"),$("#settingsModal").modal("show")}function E(){document.getElementById("startBtn").style.display="none",document.getElementById("skipBtn").style.display="inline-block",document.getElementById("stopBtn").style.display="inline-block",document.getElementById("statusMessage").textContent="Searching for user...",B()}function v(){r&&r.close(),c&&c.getTracks().forEach(e=>e.stop()),t.srcObject=null,n.srcObject=null,i=!1,document.getElementById("startBtn").style.display="inline-block",document.getElementById("skipBtn").style.display="none",document.getElementById("stopBtn").style.display="none",document.getElementById("statusMessage").innerHTML='Click <i class="fa-solid fa-play"></i> to begin',m.emit("leave")}function h(e,t,n,a,o,l,c=!1){var s,e=document.getElementById(e),r=localStorage.getItem("darkMode"),m=document.createElement("div"),d=(m.className="true"==r?"comment dark-mode":"comment",document.createElement("div")),i=(d.className="img-cont",document.createElement("img")),a=(i.src=a,i.alt="User Avatar",d.appendChild(i),document.createElement("div")),i=(a.className="comment-content",document.createElement("div")),t=(i.className="username",i.innerHTML=`@${t} <img class="flag" src="https://flagcdn.com/w40/${n.toLowerCase()}.png" style="height: 10px; width: 10px; margin-right: 0px;">, `,document.createElement(c?"img":"div")),n=(t.className="message",o.match(/```(\w+)?\n([\s\S]*?)```/)),g=(n?(g=n[1]||"",n=n[2],u=document.createElement("pre"),(s=document.createElement("code")).className=g,s.textContent=n,u.className="true"==r?"theme-atom-one-dark":"theme-atom-one-light",u.appendChild(s),t.appendChild(u),hljs.highlightElement(s)):c?t.src=o:t.innerText=o,document.createElement("div")),n=l.split(/[, :]+/),u=new Date(Date.UTC(n[3],(r=n[2],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(r)),n[1],n[4],n[5],n[6]));g.innerText=u.toLocaleString(),g.className="time",a.appendChild(i),a.appendChild(t),a.appendChild(g),m.appendChild(d),m.appendChild(a),e.appendChild(m),e.scrollTop=e.scrollHeight}function B(){navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(e=>{c=e,t.srcObject=e,(r=new RTCPeerConnection(g)).addStream(c),r.onaddstream=e=>{s=e.stream,n.srcObject=s},r.onicecandidate=e=>{e.candidate&&m.emit("candidate",e.candidate)},m.emit("join",{username:localStorage.getItem("username"),country:localStorage.getItem("country"),avatar:localStorage.getItem("profilePic")}),m.on("offer",async(e,t)=>{await r.setRemoteDescription(t);t=await r.createAnswer();await r.setLocalDescription(t),m.emit("answer",e,r.localDescription)}),m.on("answer",e=>{r.setRemoteDescription(e)}),m.on("candidate",e=>{r.addIceCandidate(new RTCIceCandidate(e))}),m.on("mute",e=>{}),m.on("skip",()=>{B()}),m.on("privateMessage",e=>{h("privateMessages",e.username,e.country,e.profilePic,e.message,e.time,e.gif)}),m.on("disconnect",()=>{v()}),i=!0}).catch(e=>{console.error("Error accessing media devices.",e),v(),alert("Could not start video source. Please ensure you have a working camera and microphone.")})}document.addEventListener("DOMContentLoaded",()=>{"true"===localStorage.getItem("darkMode")&&p();var e,t="US";localStorage.getItem("username")&&(e=localStorage.getItem("username"),document.getElementById("username").value=e,document.getElementById("userName").innerText=e),localStorage.getItem("profilePic")&&(document.getElementById("profilePic").value=localStorage.getItem("profilePic"),document.getElementById("userAvatar").src=localStorage.getItem("profilePic"),e=localStorage.getItem("profilePic"),l.src=e),localStorage.getItem("country")&&(document.getElementById("country").value=localStorage.getItem("country"),t=localStorage.getItem("country"),o.src=`https://flagcdn.com/w40/${t.toLowerCase()}.png`),localStorage.getItem("username")&&localStorage.getItem("profilePic")&&localStorage.getItem("country")||I(),(m=io.connect("https://converso-2ub4.onrender.com")).on("globalMessage",e=>{h("globalMessages",e.username,e.country,e.profilePic,e.message,e.time,e.gif)}),m.on("connect",()=>{console.log("Connected to WebSocket server")}),m.on("disconnect",()=>{v()})}),setInterval(function(){debugger},500);
